# After アプリ 送信フロー自動テスト仕様

## 概要
送信フローの仕様準拠をコードで保証するための自動テストです。
手動確認に依存せず、以下の要件を自動検証します。

## テストファイル
- `test/now_sheet_test.dart`: NowSheet送信フローのテスト
- `test/calendar_page_test.dart`: CalendarPage日付タップ挙動のテスト

## 仕様チェック表

### 1. 成功ケース
**要件**: 送信成功時にシートが閉じ、refreshが呼ばれる

**テスト**: `成功ケース: 送信成功時にシートが閉じ、refreshが呼ばれる`
- ✅ 送信中はローディング表示
- ✅ 「保存しました」が表示される
- ✅ シートが閉じる（Navigator.popが呼ばれる）
- ✅ CalendarController.refresh()が呼ばれる

### 2. 失敗ケース
**要件**: 保存失敗時にシートが閉じず、エラー表示される

**テスト**: `失敗ケース: 保存失敗時にシートが閉じず、エラー表示される`
- ✅ シートが閉じない
- ✅ エラーメッセージが表示される
- ✅ ボタンが再度押せる（isSubmittingがfalseに戻る）

### 3. 連打防止
**要件**: 送信中に2回タップしても保存処理は1回のみ

**テスト**: `連打防止: 送信中に2回タップしても保存処理は1回のみ`
- ✅ 送信中はボタンが無効
- ✅ 保存処理が1回のみ呼ばれる

### 4. 空文字送信
**要件**: 空文字送信時にエラーメッセージが表示される

**テスト**: `空文字送信: エラーメッセージが表示される`
- ✅ エラーメッセージが表示される

## 実行方法
```bash
flutter test
```

## 注意事項
- Isarを使用しているため、実際のDB保存はモックでスキップします
- NotificationServiceの初期化エラーは無視されます（保存成功を妨げない）
- テストは最小限の変更で既存構造を尊重しています





